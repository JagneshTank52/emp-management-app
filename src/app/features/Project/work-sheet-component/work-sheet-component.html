<div class="container-fluid dashboard-container h-100 px-0">
  <!-- Header -->
  <mat-grid-list cols="4" rowHeight="70px" class="mb-3">
    <mat-grid-tile colspan="4">
      <div class="d-flex align-items-center justify-content-between h-100 w-100 px-4">
        <h4 class="fw-semibold mb-0">Work Sheet</h4>
      </div>
    </mat-grid-tile>
  </mat-grid-list>

  <!-- Card -->
  <mat-card appearance="outlined" class="outlined-blur w-100 d-flex flex-column">
    <!-- Legend -->
    <mat-card-header class="timesheet-header">
      <mat-card-title>
        {{ getMonthLabel(selectedMonth) }} - {{ selectedYear }}
      </mat-card-title>
      <div class="d-flex flex-wrap gap-3 legend-items">
        <ng-container *ngFor="let legend of legends">
          <div class="d-flex align-items-center gap-1">
            <span class="legend-box" [style.background-color]="legend.color"></span>
            <span>{{ legend.label }}</span>
          </div>
        </ng-container>
      </div>
    </mat-card-header>

    <!-- Timesheet Table -->
    <mat-card-content>
      <div class="timesheet-grid-wrapper mat-elevation-z1">
        <table mat-table [dataSource]="filteredTasks" class="mat-elevation-z1 timesheet-table">

          <!-- Work Items -->
          <ng-container matColumnDef="workItem">
            <th mat-header-cell *matHeaderCellDef class="sticky-column-1">Work Items</th>
            <td mat-cell *matCellDef="let task" class="sticky-column-1 task-item" [style.background-color]="task.color">
              <mat-icon>assignment</mat-icon>
              <span>{{ task.id }}: {{ task.title }}</span>
            </td>
          </ng-container>

          <!-- P Column -->
          <ng-container matColumnDef="p">
            <th mat-header-cell *matHeaderCellDef class="sticky-column-2">P</th>
            <td mat-cell *matCellDef="let task" class="sticky-column-2">{{ task.p || '00:00' }}</td>
          </ng-container>

          <!-- Σ Column -->
          <ng-container matColumnDef="sum">
            <th mat-header-cell *matHeaderCellDef class="sticky-column-3">Σ</th>
            <td mat-cell *matCellDef="let task" class="sticky-column-3">{{ task.sum || '00:00' }}</td>
          </ng-container>

          <!-- Dynamic Day Columns -->
          <ng-container *ngFor="let day of daysInMonth" [matColumnDef]="day.date">
            <th mat-header-cell *matHeaderCellDef>
              {{ day.dayNumber }}<br>{{ day.dayOfWeek }}
            </th>
            <td mat-cell *matCellDef="let task" class="time-block-cell"
                [ngClass]="getDayClass(day)">
              <span *ngIf="getDailyHours(task, day.date)">
                {{ getDailyHours(task, day.date) }}
              </span>
            </td>
          </ng-container>

          <!-- Header & Rows -->
          <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>

          <!-- Summary Rows -->
          <tr class="summary-row">
            <td class="sticky-column-1">Daily work log hours</td>
            <td class="sticky-column-2"></td>
            <td class="sticky-column-3"></td>
            <td *ngFor="let day of daysInMonth">{{ getDailyWorkLog(day.date) }}</td>
          </tr>
          <tr class="summary-row">
            <td class="sticky-column-1">Daily time log hours</td>
            <td class="sticky-column-2"></td>
            <td class="sticky-column-3"></td>
            <td *ngFor="let day of daysInMonth">{{ getDailyTimeLog(day.date) }}</td>
          </tr>
        </table>
      </div>
    </mat-card-content>
  </mat-card>
</div>
